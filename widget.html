<!doctype html>
<html lang="en">
  <head>
    <title>widget tester</title>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="assets/saasquatch-icon-p.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="stylesheet" href="src/style.css" />
  </head>
  <body>
    <header class="layout">
      <div>
        <a href="#" target="_blank">
          <img src="assets/impact-icon.svg" class="logo impact" alt="Impact logo" />
        </a>

        <h1>Widget Tester</h1>
      </div>
    </header>

    <div class="layout wide">
      <div class="widget-config">
        <button class="accordion">
          <i id="accordionArrow" class="arrow" style="margin-right: 10px; transform: rotate(-45deg)"></i>Widget
          Configuration
        </button>
        <div class="panel">
          <form id="widgetForm" class="form form-wide" action="" method="get">
            UTT:
            <input
              type="text"
              id="utt"
              name="utt"
              value=""
              placeholder="BA5523570-3543-44c6-8139-123abccde4321"
            /><br /><br />
            JWT:
            <textarea rows="6" style="width: 100%" id="jwt" name="jwt"></textarea><br /><br />
            Program ID: <input type="text" id="programID" name="programID" value="" /><br /><br />
            Widget ID:
            <input type="text" id="widgetID" name="widgetID" placholder="referrerWidget" value="" /><br /><br />
            <input type="submit" id="submit-button" value="Submit" />
          </form>
        </div>
      </div>

      <div id="widget"></div>
    </div>

    <script type="text/javascript" src="src/main.js"></script>
    <script type="text/javascript">
      // load widget
      loadWidget();

      function loadWidget() {
        console.log("Load widget!");

        // load query vars
        let field = "";
        let params = {
          utt: getQueryString("utt"),
          jwt: getQueryString("jwt"),
          programID: getQueryString("programID"),
          widgetID: getQueryString("widgetID"),
        };

        // load field values
        field = document.querySelector("#utt");
        field.value = params.utt;

        field = document.querySelector("#jwt");
        field.value = params.jwt;

        field = document.querySelector("#programID");
        field.value = params.programID;

        field = document.querySelector("#widgetID");
        field.value = params.widgetID;

        let utt = `https://utt.impactcdn.com/${params.utt}.js`;
        window.impactToken = params.jwt;

        if (params.utt) {
          const widgetContainer = document.querySelector("#widget");
          let widgetSnippet = `<impact-embed widget="p/${params.programID}/w/${params.widgetID}"><div>Loading...</div></impact-embed>`;
          widgetContainer.innerHTML = widgetSnippet;
          console.log(widgetSnippet);
        }

        (function (a, b, c, d, e, f, g) {
          e["ire_o"] = c;
          e[c] =
            e[c] ||
            function () {
              (e[c].a = e[c].a || []).push(arguments);
            };
          f = d.createElement(b);
          g = d.getElementsByTagName(b)[0];
          f.async = 1;
          f.src = a;
          g.parentNode.insertBefore(f, g);
        })(utt, "script", "ire", document, window);
      }
    </script>
  </body>
</html>
